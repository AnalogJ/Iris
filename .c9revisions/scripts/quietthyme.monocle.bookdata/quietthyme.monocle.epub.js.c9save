{"ts":1355612731747,"silentsave":true,"restoring":false,"patch":[[]],"length":0}
{"contributors":[],"silentsave":false,"ts":1355612736839,"patch":[[{"diffs":[[1,"// @reference jszip.js\r\n\r\nvar QT = QT || {};\r\n\r\nQT.bookdata = (function(qt){\r\n    \r\n    //////////////////////////////////////////////////////////////////////////\r\n    // Private Data\r\n    //////////////////////////////////////////////////////////////////////////\r\n    var EVENT_LOADING = 'EVENT_LOADING';\r\n    \r\n    var MSG = {};\r\n    MSG.LOADING_FILE = 'Loading file from url';\r\n    MSG.UNZIPPING = 'Unzipping';\r\n    MSG.UNCOMPRESSING = 'Uncompressing file: ';\r\n    MSG.READING_OPF = 'Reading OPF';\r\n    MSG.POST_PROCESSING = 'Post processing';\r\n    MSG.FINISHED = 'Finished!';\r\n    \r\n    MSG.ERR_NOT_ZIP = 'File is not a proper Zip file';\r\n    MSG.ERR_BLANK_URL = 'Zip url cannot be blank';\r\n    \r\n    var STATE = {};\r\n    STATE.OK = 1;\r\n    STATE.ERR = 2;\r\n    \r\n    var unzipper;\r\n    var compressedFiles;\r\n    var files = {};\r\n    var opfPath;\r\n    var container;\r\n    //////////////////////////////////////////////////////////////////////////\r\n    // Private Methods\r\n    //////////////////////////////////////////////////////////////////////////\r\n    /**\r\n     * Determines if browser is a version of IE that supports ActiveXObjects.\r\n     */ \r\n    function useMSXHR() {\r\n        return typeof ActiveXObject == \"function\";\r\n    }\r\n    /**\r\n     * Retrieves the epub file from url,\r\n     * @param {String} url The url for the epub file.\r\n     * @param {Function} callback The callback that is executed once the epub file has been retrieved.\r\n     */ \r\n    function getBinaryFile(url, callback) {\r\n        var request = useMSXHR() ? new ActiveXObject(\"Msxml2.XmlHttp.6.0\")\r\n\t\t\t\t: new XMLHttpRequest();\r\n\t\trequest.onreadystatechange = function() {\r\n\t\t\tif (request.readyState == 1) {\r\n\t\t\t\tif (request.overrideMimeType) {\r\n\t\t\t\t\trequest\r\n\t\t\t\t\t\t\t.overrideMimeType('text/plain; charset=x-user-defined');\r\n\t\t\t\t}\r\n\t\t\t\trequest.send();\r\n\t\t\t}\r\n\r\n\t\t\tif (request.readyState == 4) {\r\n\t\t\t\tif (request.status == 200) {\r\n\t\t\t\t\tvar data;\r\n\t\t\t\t\tif (useMSXHR()) {\r\n\t\t\t\t\t\tvar data = new VBArray(request.responseBody).toArray();\r\n\t\t\t\t\t\tfor ( var j = 0; j < data.length; ++j)\r\n\t\t\t\t\t\t\tdata[j] = String.fromCharCode(data[j]);\r\n\t\t\t\t\t\tcallback(data.join(''));\r\n\t\t\t\t\t\trequest.abort();\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tcallback(request.responseText);\r\n\t\t\t\t\t}\r\n\t\t\t\t} else {\r\n\t\t\t\t\tconsole.log('Failed to get file ' + url + '<br>');\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t\trequest.open(\"GET\", url, true);\r\n\t}\r\n    \r\n    /**\r\n     * Retrieves the epub file from url, then begins the process of parsing it by retrievig the container.xml file.\r\n     * @param {data} data contained inside the epub file.\r\n     */\r\n    function unzipBlob(data) {\r\n        try{\r\n            publish(EVENT_LOADING, STATE.OK,MSG.UNZIPPING);\r\n            unzipper = new JSZip();\r\n            unzipper.load(data, {\r\n                base64 : false\r\n            });\r\n            \r\n            console.log(unzipper);\r\n            console.log(unzipper.files);\r\n            compressedFiles= unzipper.files;\r\n            uncompressNextCompressedFile()\r\n            \r\n        }\r\n        catch(ex){\r\n            publish(EVENT_LOADING, STATE.ERR,MSG.ERR_NOT_ZIP);\r\n        }\r\n\t}\r\n    \r\n    function uncompressNextCompressedFile() {\r\n        var compressedFile = compressedFiles.shift();\r\n        if (compressedFile) {\r\n            publish(EVENT_LOADING, STATE.OK, MSG.UNCOMPRESSING + compressedFile.name);\r\n            uncompressFile(compressedFile);\r\n            withTimeout(uncompressNextCompressedFile);\r\n        } else {\r\n            didUncompressAllFiles();\r\n        }\r\n    };\r\n        \r\n    // For mockability\r\n    function withTimeout(func) {\r\n        var self = this;\r\n        setTimeout(function () {\r\n            func.call(self);\r\n        }, 30);\r\n    };\r\n\r\n    function didUncompressAllFiles() {\r\n            publish(EVENT_LOADING, STATE.OK, MSG.READING_OPF);\r\n            opfPath = getOpfPathFromContainer();\r\n            readOpf(files[opfPath]);\r\n\r\n            publish(EVENT_LOADING, STATE.OK, MSG.POST_PROCESSING);\r\n            postProcess();\r\n            publish(EVENT_LOADING, STATE.OK, MSG.FINISHED);\r\n        },\r\n\r\n    function uncompressFile(compressedFile) {\r\n        var data = compressedFile.data;\r\n\r\n        if (compressedFile.name === \"META-INF/container.xml\") {\r\n            this.container = data;\r\n        } else if (compressedFile.fileName === \"mimetype\") {\r\n            this.mimetype = data;\r\n        } else {\r\n            this.files[compressedFile.fileName] = data;\r\n        }\r\n    }\r\n    \r\n    \r\n    \r\n    //////////////////////////////////////////////////////////////////////////\r\n    // Public Methods\r\n    //////////////////////////////////////////////////////////////////////////\r\n    var init = function(url, options){\r\n        \r\n        if(url){\r\n            publish(EVENT_LOADING, STATE.OK,MSG.LOADING_FILE);\r\n            getBinaryFile(url,unzipBlob);\r\n            \r\n        }\r\n        else{\r\n            publish(EVENT_LOADING, STATE.ERR,MSG.ERR_BLANK_URL);\r\n        }\r\n        \r\n        \r\n    };\r\n    \r\n    //////////////////////////////////////////////////////////////////////////\r\n    // Messaging Methods\r\n    //////////////////////////////////////////////////////////////////////////\r\n    \r\n    function publish(event, state, message){\r\n        $(window).trigger(event, [state, message]);\r\n    }\r\n    function subscribe(selector, event, handler){\r\n        $(selector).bind(event, handler);\r\n    }\r\n    \r\n    \r\n    //////////////////////////////////////////////////////////////////////////\r\n    // Monocle Book Data Interface Methods \r\n    // https://github.com/joseph/Monocle/wiki/Book-data-object\r\n    //////////////////////////////////////////////////////////////////////////\r\n    \r\n    var getComponents = function () {\r\n    \r\n    }\r\n    var getContents = function () {\r\n       \r\n    }\r\n    var getComponent = function (componentId) {\r\n    \r\n    }\r\n    var getMetaData = function(key) {\r\n    \r\n    }\r\n    \r\n    return {\r\n        init : init,\r\n        \r\n        /*Monocle Book Data Interface Methods*/\r\n        getComponents : getComponents,\r\n        getContents : getContents,\r\n        getComponent : getComponent,\r\n        getMetaData : getMetaData\r\n    }\r\n        \r\n    \r\n})(QT)\r\n\r\n\r\n"]],"start1":0,"start2":0,"length1":0,"length2":6138}]],"length":6138,"saved":false}
{"ts":1355613001236,"patch":[[{"diffs":[[0,"sedFile."],[-1,"fileN"],[1,"n"],[0,"ame === "]],"start1":4257,"start2":4257,"length1":21,"length2":17},{"diffs":[[0,"ile."],[-1,"fileN"],[1,"n"],[0,"ame]"]],"start1":4376,"start2":4376,"length1":13,"length2":9}]],"length":6130,"saved":false}
{"ts":1355613012996,"patch":[[{"diffs":[[0,"container;\r\n"],[1,"    var mimetype;\r\n"],[0,"    ////////"]],"start1":859,"start2":859,"length1":24,"length2":43}]],"length":6149,"saved":false}
{"ts":1355613026428,"patch":[[{"diffs":[[0,"        "],[-1,"this."],[1,"var "],[0,"containe"]],"start1":4218,"start2":4218,"length1":21,"length2":20},{"diffs":[[0,"        "],[-1,"this."],[0,"mimetype"]],"start1":4311,"start2":4311,"length1":21,"length2":16}]],"length":6143,"saved":false}
{"ts":1355613029553,"patch":[[{"diffs":[[0,"            "],[-1,"var "],[0,"container = "]],"start1":4214,"start2":4214,"length1":28,"length2":24}]],"length":6139,"saved":false}
{"ts":1355613034038,"patch":[[{"diffs":[[0,"    "],[-1,"this."],[0,"file"]],"start1":4359,"start2":4359,"length1":13,"length2":8}]],"length":6134,"saved":false}
{"ts":1355613125002,"patch":[[{"diffs":[[0," }\r\n    \r\n    \r\n"],[1,"    function getOpfPathFromContainer() {\r\n            var doc = this.xmlDocument(this.container);\r\n            return doc\r\n                .getElementsByTagName(\"rootfile\")[0]\r\n                .getAttribute(\"full-path\");\r\n        },\r\n\r\n        readOpf: function (xml) {\r\n            var doc = this.xmlDocument(xml);\r\n            \r\n            var opf = {\r\n                metadata: {},\r\n                manifest: {},\r\n                spine: []\r\n            };\r\n\r\n            var metadataNodes = doc\r\n                .getElementsByTagName(\"metadata\")[0]\r\n                .childNodes;\r\n\r\n            for (var i = 0, il = metadataNodes.length; i < il; i++) {\r\n                var node = metadataNodes[i];\r\n                // Skip text nodes (whitespace)\r\n                if (node.nodeType === 3) { continue }\r\n\r\n                var attrs = {};\r\n                for (var i2 = 0, il2 = node.attributes.length; i2 < il2; i2++) {\r\n                    var attr = node.attributes[i2];\r\n                    attrs[attr.name] = attr.value;\r\n                }\r\n                attrs._text = node.textContent;\r\n                opf.metadata[node.nodeName] = attrs;\r\n            }\r\n\r\n            var manifestEntries = doc\r\n                .getElementsByTagName(\"manifest\")[0]\r\n                .getElementsByTagName(\"item\");\r\n\r\n            for (var i = 0, il = manifestEntries.length; i < il; i++) {\r\n                var node = manifestEntries[i];\r\n\r\n                opf.manifest[node.getAttribute(\"id\")] = {\r\n                    \"href\": this.resolvePath(node.getAttribute(\"href\"), this.opfPath),\r\n                    \"media-type\": node.getAttribute(\"media-type\")\r\n                }\r\n            }\r\n\r\n            var spineEntries = doc\r\n                .getElementsByTagName(\"spine\")[0]\r\n                .getElementsByTagName(\"itemref\");\r\n\r\n            for (var i = 0, il = spineEntries.length; i < il; i++) {\r\n                var node = spineEntries[i];\r\n                opf.spine.push(node.getAttribute(\"idref\"));\r\n            }\r\n\r\n            this.opf = opf;\r\n        },\r\n\r\n        resolvePath: function (path, referrerLocation) {\r\n            var pathDirs = path.split(\"/\");\r\n            var fileName = pathDirs.pop();\r\n\r\n            var locationDirs = referrerLocation.split(\"/\");\r\n            locationDirs.pop();\r\n\r\n            for (var i = 0, il = pathDirs.length; i < il; i++) {\r\n                var spec = pathDirs[i];\r\n                if (spec === \"..\") {\r\n                    locationDirs.pop();\r\n                } else {\r\n                    locationDirs.push(spec);\r\n                }\r\n            }\r\n\r\n            locationDirs.push(fileName);\r\n            return locationDirs.join(\"/\");\r\n        },\r\n\r\n        findMediaTypeByHref: function (href) {\r\n            for (key in this.opf.manifest) {\r\n                var item = this.opf.manifest[key];\r\n                if (item[\"href\"] === href) {\r\n                    return item[\"media-type\"];\r\n                }\r\n            }\r\n\r\n            // Best guess if it's not in the manifest. (Those bastards.)\r\n            var match = href.match(/\\.(\\w+)$/);\r\n            return match && \"image/\" + match[1];\r\n        },\r\n\r\n        // Will modify all HTML and CSS files in place.\r\n        postProcess: function () {\r\n            for (var key in this.opf.manifest) {\r\n                var mediaType = this.opf.manifest[key][\"media-type\"]\r\n                var href = this.opf.manifest[key][\"href\"]\r\n                var result;\r\n\r\n                if (mediaType === \"text/css\") {\r\n                    result = this.postProcessCSS(href);\r\n                } else if (mediaType === \"application/xhtml+xml\") {\r\n                    result = this.postProcessHTML(href);\r\n                }\r\n\r\n                if (result !== undefined) {\r\n                    this.files[href] = result;\r\n                }\r\n            }\r\n        },\r\n    \r\n"],[0,"    \r\n    //////"]],"start1":4413,"start2":4413,"length1":32,"length2":3896}]],"length":9998,"saved":false}
{"ts":1355613132972,"patch":[[{"diffs":[[0,"er() {\r\n        "],[-1,"    "],[0,"var doc = this.x"]],"start1":4463,"start2":4463,"length1":36,"length2":32},{"diffs":[[0,"      var doc = "],[-1,"this."],[0,"xmlDocument(this"]],"start1":4473,"start2":4473,"length1":37,"length2":32}]],"length":9989,"saved":false}
{"ts":1355613135280,"patch":[[{"diffs":[[0,"ocument("],[-1,"this."],[0,"containe"]],"start1":4493,"start2":4493,"length1":21,"length2":16}]],"length":9984,"saved":false}
{"ts":1355613144691,"patch":[[{"diffs":[[0,");\r\n        "],[-1,"    "],[0,"return doc\r\n"]],"start1":4510,"start2":4510,"length1":28,"length2":24},{"diffs":[[0,"return doc\r\n"],[-1,"    "],[0,"            "]],"start1":4522,"start2":4522,"length1":28,"length2":24},{"diffs":[[0,"            "],[-1," "],[-1,"   "],[0,".getAttribut"]],"start1":4584,"start2":4584,"length1":28,"length2":24},{"diffs":[[0,"ll-path\");\r\n    "],[-1,"    },"],[1,"}"],[0,"\r\n\r\n        read"]],"start1":4613,"start2":4613,"length1":38,"length2":33}]],"length":9967,"saved":false}
{"ts":1355613179094,"patch":[[{"diffs":[[0,"\n   "],[-1,"     readOpf:"],[0," fun"]],"start1":4633,"start2":4633,"length1":21,"length2":8},{"diffs":[[0,"unction "],[1,"readOpf"],[0,"(xml) {\r"]],"start1":4639,"start2":4639,"length1":16,"length2":23},{"diffs":[[0,"Opf(xml) {\r\n"],[-1,"    "],[0,"        var "]],"start1":4651,"start2":4651,"length1":28,"length2":24},{"diffs":[[0,"r doc = "],[-1,"this."],[0,"xmlDocum"]],"start1":4673,"start2":4673,"length1":21,"length2":16},{"diffs":[[0,"  \r\n        "],[-1,"    "],[0,"var opf = {\r"]],"start1":4710,"start2":4710,"length1":28,"length2":24},{"diffs":[[0,"ar opf = {\r\n"],[-1,"    "],[0,"            "]],"start1":4723,"start2":4723,"length1":28,"length2":24},{"diffs":[[0,"        "],[-1,"    "],[0,"manifest"]],"start1":4766,"start2":4766,"length1":20,"length2":16},{"diffs":[[0,"        "],[-1,"    "],[0,"spine: ["]],"start1":4793,"start2":4793,"length1":20,"length2":16},{"diffs":[[0,"ne: []\r\n"],[-1,"    "],[0,"        "]],"start1":4804,"start2":4804,"length1":20,"length2":16}]],"length":9932,"saved":false}
{"ts":1355613209838,"patch":[[{"diffs":[[0,"\r\n\r\n        "],[-1,"    "],[0,"var metadata"]],"start1":4822,"start2":4822,"length1":28,"length2":24},{"diffs":[[0,"ataNodes = doc\r\n"],[-1,"    "],[0,"            .get"]],"start1":4843,"start2":4843,"length1":36,"length2":32},{"diffs":[[0,"        "],[-1,"    "],[0,".childNo"]],"start1":4913,"start2":4913,"length1":20,"length2":16},{"diffs":[[0,"des;\r\n\r\n        "],[-1," "],[-1,"   "],[0,"for (var i = 0, "]],"start1":4929,"start2":4929,"length1":36,"length2":32},{"diffs":[[0," {\r\n            "],[-1,"   "],[-1," "],[0,"var node = metad"]],"start1":5000,"start2":5000,"length1":36,"length2":32},{"diffs":[[0,"adataNodes[i];\r\n"],[-1,"    "],[0,"            // S"]],"start1":5030,"start2":5030,"length1":36,"length2":32},{"diffs":[[0,"            "],[-1," "],[-1,"   "],[0,"if (node.nod"]],"start1":5091,"start2":5091,"length1":28,"length2":24},{"diffs":[[0,"ntinue }\r\n\r\n"],[-1,"    "],[0,"            "]],"start1":5132,"start2":5132,"length1":28,"length2":24},{"diffs":[[0,"};\r\n            "],[-1,"    "],[0,"for (var i2 = 0,"]],"start1":5169,"start2":5169,"length1":36,"length2":32},{"diffs":[[0,"                "],[-1,"  "],[-1,"  "],[0,"var attr = node."]],"start1":5251,"start2":5251,"length1":36,"length2":32},{"diffs":[[0,"butes[i2];\r\n"],[-1,"    "],[0,"            "]],"start1":5288,"start2":5288,"length1":28,"length2":24},{"diffs":[[0,"e;\r\n            "],[-1,"    "],[0,"}\r\n             "]],"start1":5344,"start2":5344,"length1":36,"length2":32},{"diffs":[[0,"            "],[-1,"  "],[-1,"  "],[0,"attrs._text "]],"start1":5363,"start2":5363,"length1":28,"length2":24},{"diffs":[[0,"xtContent;\r\n"],[-1,"    "],[0,"            "]],"start1":5396,"start2":5396,"length1":28,"length2":24},{"diffs":[[0,"attrs;\r\n        "],[-1,"    "],[0,"}\r\n\r\n           "]],"start1":5450,"start2":5450,"length1":36,"length2":32},{"diffs":[[0,"\r\n\r\n        "],[-1,"   "],[-1," "],[0,"var manifest"]],"start1":5467,"start2":5467,"length1":28,"length2":24},{"diffs":[[0,"tEntries = doc\r\n"],[-1,"    "],[0,"            .get"]],"start1":5490,"start2":5490,"length1":36,"length2":32},{"diffs":[[0,"0]\r\n            "],[-1," "],[-1,"   "],[0,".getElementsByTa"]],"start1":5552,"start2":5552,"length1":36,"length2":32},{"diffs":[[0,"m\");\r\n\r\n        "],[-1,"   "],[-1," "],[0,"for (var i = 0, "]],"start1":5594,"start2":5594,"length1":36,"length2":32},{"diffs":[[0," {\r\n            "],[-1,"    "],[0,"var node = manif"]],"start1":5667,"start2":5667,"length1":36,"length2":32},{"diffs":[[0,"            "],[-1,"  "],[-1,"  "],[0,"opf.manifest"]],"start1":5717,"start2":5717,"length1":28,"length2":24},{"diffs":[[0,"\"id\")] = {\r\n"],[-1,"    "],[0,"            "]],"start1":5760,"start2":5760,"length1":28,"length2":24},{"diffs":[[0,"        "],[-1,"    "],[0,"\"media-t"]],"start1":5864,"start2":5864,"length1":20,"length2":16},{"diffs":[[0,"            "],[-1,"    }\r\n    "],[1,"}\r\n"],[0,"        }\r\n\r"]],"start1":5919,"start2":5919,"length1":35,"length2":27}]],"length":9832,"saved":false}
{"ts":1355613226727,"patch":[[{"diffs":[[0,"\r\n\r\n        "],[-1,"    "],[0,"var spineEnt"]],"start1":5943,"start2":5943,"length1":28,"length2":24},{"diffs":[[0,"eEntries = doc\r\n"],[-1,"    "],[0,"            .get"]],"start1":5963,"start2":5963,"length1":36,"length2":32},{"diffs":[[0,"0]\r\n            "],[-1,"   "],[-1," "],[0,".getElementsByTa"]],"start1":6022,"start2":6022,"length1":36,"length2":32},{"diffs":[[0,"emref\");\r\n\r\n"],[-1,"    "],[0,"        for "]],"start1":6063,"start2":6063,"length1":28,"length2":24},{"diffs":[[0," {\r\n            "],[-1,"    "],[0,"var node = spine"]],"start1":6137,"start2":6137,"length1":36,"length2":32},{"diffs":[[0,"            "],[-1," "],[-1,"   "],[0,"opf.spine.pu"]],"start1":6182,"start2":6182,"length1":28,"length2":24},{"diffs":[[0,"ef\"));\r\n        "],[-1,"    "],[0,"}\r\n\r\n           "]],"start1":6231,"start2":6231,"length1":36,"length2":32},{"diffs":[[0,"        "],[-1,"    this."],[0,"opf = op"]],"start1":6252,"start2":6252,"length1":25,"length2":16},{"diffs":[[0,"= opf;\r\n    "],[-1,"    },"],[1,"}"],[0,"\r\n\r\n        "]],"start1":6264,"start2":6264,"length1":30,"length2":25}]],"length":9790,"saved":false}
{"ts":1355613244357,"patch":[[{"diffs":[[0," mimetype;\r\n"],[1,"    var opf;\r\n"],[0,"    ////////"]],"start1":878,"start2":878,"length1":24,"length2":38}]],"length":9804,"saved":false}
{"ts":1355613264991,"patch":[[{"diffs":[[0,"    var "],[1,"_"],[0,"unzipper"]],"start1":767,"start2":767,"length1":16,"length2":17},{"diffs":[[0,"ipper;\r\n    var "],[1,"_"],[0,"compressedFiles;"]],"start1":779,"start2":779,"length1":32,"length2":33},{"diffs":[[0,"s;\r\n    var "],[1,"_"],[0,"files = {};\r"]],"start1":810,"start2":810,"length1":24,"length2":25},{"diffs":[[0,"    var "],[1,"_"],[0,"opfPath;"]],"start1":836,"start2":836,"length1":16,"length2":17},{"diffs":[[0,"    var "],[1,"_"],[0,"containe"]],"start1":855,"start2":855,"length1":16,"length2":17},{"diffs":[[0,"    var "],[1,"_"],[0,"mimetype"]],"start1":876,"start2":876,"length1":16,"length2":17},{"diffs":[[0,"    var "],[1,"_"],[0,"opf;\r\n  "]],"start1":896,"start2":896,"length1":16,"length2":17}]],"length":9811,"saved":false}
{"ts":1355613471017,"patch":[[{"diffs":[[0,");\r\n            "],[1,"_"],[0,"unzipper = new J"]],"start1":2696,"start2":2696,"length1":32,"length2":33},{"diffs":[[0,"        "],[1,"_"],[0,"unzipper"]],"start1":2742,"start2":2742,"length1":16,"length2":17},{"diffs":[[0,"    console.log("],[1,"_"],[0,"unzipper);\r\n    "]],"start1":2845,"start2":2845,"length1":32,"length2":33},{"diffs":[[0,"ole.log("],[1,"_"],[0,"unzipper"]],"start1":2890,"start2":2890,"length1":16,"length2":17},{"diffs":[[0,"dFiles= "],[1,"_"],[0,"unzipper"]],"start1":2938,"start2":2938,"length1":16,"length2":17},{"diffs":[[0,"        "],[1,"_"],[0,"opfPath "]],"start1":3828,"start2":3828,"length1":16,"length2":17},{"diffs":[[0,"readOpf("],[1,"_"],[0,"files["],[1,"_"],[0,"opfPath]"]],"start1":3887,"start2":3887,"length1":22,"length2":24},{"diffs":[[0,"        "],[-1,""],[0,""],[1,"_"],[0,"containe"]],"start1":4247,"start2":4247,"length1":16,"length2":17},{"diffs":[[0,"        "],[1,"_"],[0,"mimetype"]],"start1":4337,"start2":4337,"length1":16,"length2":17},{"diffs":[[0,"        "],[1,"_"],[0,"files[co"]],"start1":4386,"start2":4386,"length1":16,"length2":17},{"diffs":[[0,"ocument("],[-1,""],[0,""],[1,"_"],[0,"containe"]],"start1":4525,"start2":4525,"length1":16,"length2":17},{"diffs":[[0,"        "],[1,"_"],[0,"opf = op"]],"start1":6285,"start2":6285,"length1":16,"length2":17},{"diffs":[[0,"   }\r\n\r\n    "],[-1,"   "],[1,"function"],[0," resolvePath"]],"start1":6307,"start2":6307,"length1":27,"length2":32},{"diffs":[[0,"olvePath"],[-1,": function "],[0,"(path, r"]],"start1":6331,"start2":6331,"length1":27,"length2":16},{"diffs":[[0,"ocation) {\r\n"],[-1,"    "],[0,"        var "]],"start1":6355,"start2":6355,"length1":28,"length2":24},{"diffs":[[0,");\r\n        "],[-1," "],[-1,"   "],[0,"var fileName"]],"start1":6404,"start2":6404,"length1":28,"length2":24},{"diffs":[[0,"\r\n\r\n        "],[-1,"  "],[-1,"  "],[0,"var location"]],"start1":6446,"start2":6446,"length1":28,"length2":24},{"diffs":[[0,"(\"/\");\r\n        "],[-1,"    "],[0,"locationDirs.pop"]],"start1":6499,"start2":6499,"length1":36,"length2":32},{"diffs":[[0,"s.pop();\r\n\r\n"],[-1,"    "],[0,"        for "]],"start1":6526,"start2":6526,"length1":28,"length2":24},{"diffs":[[0,"            "],[-1,"    "],[0,"var spec = p"]],"start1":6600,"start2":6600,"length1":28,"length2":24},{"diffs":[[0,"            "],[-1,"    "],[0,"if (spec ==="]],"start1":6637,"start2":6637,"length1":28,"length2":24},{"diffs":[[0,"                "],[-1,"   "],[-1," "],[0,"locationDirs.pop"]],"start1":6671,"start2":6671,"length1":36,"length2":32},{"diffs":[[0,"irs.pop();\r\n"],[-1,"    "],[0,"            "]],"start1":6696,"start2":6696,"length1":28,"length2":24},{"diffs":[[0,"                "],[-1,"    "],[0,"locationDirs.pus"]],"start1":6730,"start2":6730,"length1":36,"length2":32},{"diffs":[[0,"    "],[-1," "],[-1,"   }\r\n   "],[1,"}\r\n"],[0,"        "],[-1," "],[0,"}\r\n\r\n"],[-1,"    "],[0,"    "]],"start1":6780,"start2":6780,"length1":36,"length2":24},{"diffs":[[0,");\r\n        "],[-1,"    "],[0,"return locat"]],"start1":6834,"start2":6834,"length1":28,"length2":24},{"diffs":[[0,"join(\"/\");\r\n    "],[-1,"    },"],[1,"};"],[0,"\r\n\r\n        find"]],"start1":6866,"start2":6866,"length1":38,"length2":34}]],"length":9758,"saved":false}
{"ts":1355613479110,"patch":[[{"diffs":[[0,"\r\n\r\n    "],[-1,"   "],[1,"function"],[0," findMed"]],"start1":6884,"start2":6884,"length1":19,"length2":24},{"diffs":[[0,"peByHref"],[-1,": function "],[0,"(href) {"]],"start1":6912,"start2":6912,"length1":27,"length2":16}]],"length":9752,"saved":false}
{"ts":1355613496074,"patch":[[{"diffs":[[0," {\r\n        "],[-1,"    "],[0,"for (key in "]],"start1":6926,"start2":6926,"length1":28,"length2":24},{"diffs":[[0,"pf.manifest) {\r\n"],[-1,"    "],[0,"            var "]],"start1":6956,"start2":6956,"length1":36,"length2":32},{"diffs":[[0,"            "],[-1,"   "],[-1," "],[0,"if (item[\"hr"]],"start1":7020,"start2":7020,"length1":28,"length2":24},{"diffs":[[0,"== href) {\r\n"],[-1,"    "],[0,"            "]],"start1":7050,"start2":7050,"length1":28,"length2":24},{"diffs":[[0,"];\r\n            "],[-1,"    "],[0,"}\r\n            }"]],"start1":7102,"start2":7102,"length1":36,"length2":32},{"diffs":[[0," }\r\n        "],[-1," "],[-1,"   "],[0,"}\r\n\r\n"],[-1,"    "],[0,"        // B"]],"start1":7117,"start2":7117,"length1":37,"length2":29},{"diffs":[[0,".)\r\n        "],[-1,"   "],[-1," "],[0,"var match = "]],"start1":7200,"start2":7200,"length1":28,"length2":24},{"diffs":[[0,".(\\w+)$/);\r\n"],[-1,"    "],[0,"        retu"]],"start1":7237,"start2":7237,"length1":28,"length2":24},{"diffs":[[0,"ch[1];\r\n    "],[-1,"    },"],[1,"}"],[0,"\r\n\r\n        "]],"start1":7287,"start2":7287,"length1":30,"length2":25}]],"length":9711,"saved":false}
{"ts":1355613498939,"patch":[[{"diffs":[[0,"   for ("],[1,"var "],[0,"key in t"]],"start1":6935,"start2":6935,"length1":16,"length2":20}]],"length":9715,"saved":false}
{"ts":1355613513267,"patch":[[{"diffs":[[0,"place.\r\n    "],[-1,"   "],[1,"function"],[0," postProcess"]],"start1":7357,"start2":7357,"length1":27,"length2":32},{"diffs":[[0,"cess"],[-1,": function "],[0,"() {"]],"start1":7385,"start2":7385,"length1":19,"length2":8}]],"length":9709,"saved":false}
{"ts":1355613530231,"patch":[[{"diffs":[[0,"ss() {\r\n        "],[-1,"    "],[0,"for (var key in "]],"start1":7387,"start2":7387,"length1":36,"length2":32},{"diffs":[[0,"pf.manifest) {\r\n"],[-1,"    "],[0,"            var "]],"start1":7425,"start2":7425,"length1":36,"length2":32},{"diffs":[[0,"            "],[-1,"    "],[0,"var href = t"]],"start1":7507,"start2":7507,"length1":28,"length2":24},{"diffs":[[0,"            "],[-1,"   "],[-1," "],[0,"var result;\r"]],"start1":7562,"start2":7562,"length1":28,"length2":24},{"diffs":[[0," result;\r\n\r\n"],[-1,"    "],[0,"            "]],"start1":7577,"start2":7577,"length1":28,"length2":24},{"diffs":[[0,"                "],[-1,"  "],[-1,"  "],[0,"result = this.po"]],"start1":7634,"start2":7634,"length1":36,"length2":32},{"diffs":[[0,"cessCSS(href);\r\n"],[-1,"    "],[0,"            } el"]],"start1":7671,"start2":7671,"length1":36,"length2":32},{"diffs":[[0,"                "],[-1," "],[-1,"   "],[0,"result = this.po"]],"start1":7752,"start2":7752,"length1":36,"length2":32},{"diffs":[[0,"essHTML(href);\r\n"],[-1,"    "],[0,"            }\r\n\r"]],"start1":7790,"start2":7790,"length1":36,"length2":32},{"diffs":[[0,"            "],[-1,"    "],[0,"if (result !"]],"start1":7823,"start2":7823,"length1":28,"length2":24},{"diffs":[[0,"        "],[-1,"   "],[-1," "],[0,"this.fil"]],"start1":7872,"start2":7872,"length1":20,"length2":16},{"diffs":[[0,"    "],[-1,"    }\r\n   "],[1,"}\r\n"],[0,"        "],[-1," "],[0,"}\r\n    "],[-1,"    },"],[1,"}"],[0,"\r\n  "]],"start1":7916,"start2":7916,"length1":40,"length2":27}]],"length":9652,"saved":false}
{"ts":1355613545587,"patch":[[{"diffs":[[0,"for (var key in "],[-1,"this."],[1,"_"],[0,"opf.manifest) {\r"]],"start1":6938,"start2":6938,"length1":37,"length2":33},{"diffs":[[0," item = "],[-1,"this."],[1,"_"],[0,"opf.mani"]],"start1":6987,"start2":6987,"length1":21,"length2":17}]],"length":9644,"saved":false}
{"ts":1355613563560,"patch":[[{"diffs":[[0," key in "],[-1,"this."],[1,"_"],[0,"opf.mani"]],"start1":7403,"start2":7403,"length1":21,"length2":17},{"diffs":[[0,"aType = "],[-1,"this."],[1,"_"],[0,"opf.mani"]],"start1":7449,"start2":7449,"length1":21,"length2":17}]],"length":9636,"saved":false}
{"ts":1355613568131,"patch":[[{"diffs":[[0," href = "],[-1,"this."],[1,"_"],[0,"opf.mani"]],"start1":7506,"start2":7506,"length1":21,"length2":17}]],"length":9632,"saved":false}
{"ts":1355613574389,"patch":[[{"diffs":[[0,"       result = "],[-1,"this."],[0,"postProcessCSS(h"]],"start1":7623,"start2":7623,"length1":37,"length2":32}]],"length":9627,"saved":false}
{"ts":1355613577452,"patch":[[{"diffs":[[0,"esult = "],[-1,"this."],[0,"postProc"]],"start1":7744,"start2":7744,"length1":21,"length2":16}]],"length":9622,"saved":false}
{"ts":1355613580910,"patch":[[{"diffs":[[0,"        "],[-1,"this."],[1,"_"],[0,"files[hr"]],"start1":7842,"start2":7842,"length1":21,"length2":17}]],"length":9618,"saved":false}
{"ts":1355613612909,"patch":[[{"diffs":[[0," }\r\n    \r\n    \r\n"],[1,"    function postProcessCSS(href) {\r\n            var file = this.files[href];\r\n            var self = this;\r\n\r\n            file = file.replace(/url\\((.*?)\\)/gi, function (str, url) {\r\n                if (/^data/i.test(url)) {\r\n                    // Don't replace data strings\r\n                    return str;\r\n                } else {\r\n                    var dataUri = self.getDataUri(url, href);\r\n                    return \"url(\" + dataUri + \")\";\r\n                }\r\n            });\r\n\r\n            return file;\r\n        },\r\n\r\n        postProcessHTML: function (href) {\r\n            var xml = decodeURIComponent(escape(this.files[href]));\r\n            var doc = this.xmlDocument(xml);\r\n\r\n            var images = doc.getElementsByTagName(\"img\");\r\n            for (var i = 0, il = images.length; i < il; i++) {\r\n                var image = images[i];\r\n                var src = image.getAttribute(\"src\");\r\n                if (/^data/.test(src)) { continue }\r\n                image.setAttribute(\"src\", this.getDataUri(src, href))\r\n            }\r\n\r\n            var head = doc.getElementsByTagName(\"head\")[0];\r\n            var links = head.getElementsByTagName(\"link\");\r\n            for (var i = 0, il = links.length; i < il; i++) {\r\n                var link = links[0];\r\n                if (link.getAttribute(\"type\") === \"text/css\") {\r\n                    var inlineStyle = document.createElement(\"style\");\r\n                    inlineStyle.setAttribute(\"type\", \"text/css\");\r\n                    inlineStyle.setAttribute(\"data-orig-href\", link.getAttribute(\"href\"));\r\n\r\n                    var css = this.files[this.resolvePath(link.getAttribute(\"href\"), href)];\r\n                    inlineStyle.appendChild(document.createTextNode(css));\r\n\r\n                    head.replaceChild(inlineStyle, link);\r\n                }\r\n            }\r\n\r\n            return doc;\r\n        },\r\n\r\n        getDataUri: function (url, href) {\r\n            var dataHref = this.resolvePath(url, href);\r\n            var mediaType = this.findMediaTypeByHref(dataHref);\r\n            var encodedData = escape(this.files[dataHref]);\r\n            return \"data:\" + mediaType + \",\" + encodedData;\r\n        },\r\n\r\n        validate: function () {\r\n            if (this.container === undefined) {\r\n                throw new Error(\"META-INF/container.xml file not found.\");\r\n            }\r\n\r\n            if (this.mimetype === undefined) {\r\n                throw new Error(\"Mimetype file not found.\");\r\n            }\r\n\r\n            if (this.mimetype !== \"application/epub+zip\") {\r\n                throw new Error(\"Incorrect mimetype \" + this.mimetype);\r\n            }\r\n        },\r\n\r\n        // for data URIs\r\n        escapeData: function (data) {\r\n            return escape(data);\r\n        },\r\n\r\n        xmlDocument: function (xml) {\r\n            var doc = new DOMParser().parseFromString(xml, \"text/xml\");\r\n\r\n            if (doc.childNodes[1] && doc.childNodes[1].nodeName === \"parsererror\") {\r\n                throw doc.childNodes[1].childNodes[0].nodeValue;\r\n            }\r\n\r\n            return doc;\r\n        }\r\n    \r\n    \r\n"],[0,"    ////////////"]],"start1":7903,"start2":7903,"length1":32,"length2":3118}]],"length":12704,"saved":false}
{"ts":1355613616633,"patch":[[{"diffs":[[0," file = "],[-1,"this."],[1,"_"],[0,"files[hr"]],"start1":7971,"start2":7971,"length1":21,"length2":17}]],"length":12700,"saved":false}
{"ts":1355613654068,"patch":[[{"diffs":[[0," {\r\n        "],[-1,"    "],[0,"var file = _"]],"start1":7952,"start2":7952,"length1":28,"length2":24},{"diffs":[[0,"];\r\n        "],[-1,"    "],[0,"var self = t"]],"start1":7986,"start2":7986,"length1":28,"length2":24},{"diffs":[[0," = this;\r\n\r\n"],[-1,"    "],[0,"        file"]],"start1":8006,"start2":8006,"length1":28,"length2":24},{"diffs":[[0," {\r\n            "],[-1,"  "],[-1,"  "],[0,"if (/^data/i.tes"]],"start1":8083,"start2":8083,"length1":36,"length2":32},{"diffs":[[0,"st(url)) {\r\n"],[-1,"    "],[0,"            "]],"start1":8114,"start2":8114,"length1":28,"length2":24},{"diffs":[[0,"            "],[-1,"    "],[0,"return str;\r"]],"start1":8177,"start2":8177,"length1":28,"length2":24},{"diffs":[[0,"r;\r\n            "],[-1,"   "],[-1," "],[0,"} else {\r\n      "]],"start1":8198,"start2":8198,"length1":36,"length2":32},{"diffs":[[0,"      } else {\r\n"],[-1,"    "],[0,"                "]],"start1":8208,"start2":8208,"length1":36,"length2":32},{"diffs":[[0,"                "],[-1,"    "],[0,"return \"url(\" + "]],"start1":8283,"start2":8283,"length1":36,"length2":32},{"diffs":[[0,"+ \")\";\r\n"],[-1,"    "],[0,"        "]],"start1":8323,"start2":8323,"length1":20,"length2":16},{"diffs":[[0,"    "],[-1,"    "],[0,"});\r\n\r\n"],[-1,"    "],[0,"    "]],"start1":8350,"start2":8350,"length1":23,"length2":15},{"diffs":[[0," file;\r\n    "],[-1,"    },"],[1,"}"],[0,"\r\n\r\n        "]],"start1":8375,"start2":8375,"length1":30,"length2":25}]],"length":12647,"saved":false}
{"ts":1355613703948,"patch":[[{"diffs":[[0,"   }\r\n\r\n    "],[-1,"   "],[1,"function"],[0," postProcess"]],"start1":8384,"start2":8384,"length1":27,"length2":32},{"diffs":[[0,"cessHTML"],[-1,": function "],[0,"(href) {"]],"start1":8412,"start2":8412,"length1":27,"length2":16},{"diffs":[[0," {\r\n        "],[-1,"    "],[0,"var xml = de"]],"start1":8426,"start2":8426,"length1":28,"length2":24},{"diffs":[[0,"ef]));\r\n        "],[-1,"    "],[0,"var doc = this.x"]],"start1":8487,"start2":8487,"length1":36,"length2":32},{"diffs":[[0,"r doc = "],[-1,"this."],[0,"xmlDocum"]],"start1":8505,"start2":8505,"length1":21,"length2":16},{"diffs":[[0,"nt(xml);\r\n\r\n"],[-1,"    "],[0,"        var "]],"start1":8522,"start2":8522,"length1":28,"length2":24},{"diffs":[[0,"me(\"img\");\r\n"],[-1,"    "],[0,"        for "]],"start1":8577,"start2":8577,"length1":28,"length2":24}]],"length":12620,"saved":false}
{"ts":1355613717787,"patch":[[{"diffs":[[0,"            "],[-1,"    "],[0,"var image = "]],"start1":8649,"start2":8649,"length1":28,"length2":24},{"diffs":[[0,"e = images[i];\r\n"],[-1,"    "],[0,"            var "]],"start1":8669,"start2":8669,"length1":36,"length2":32},{"diffs":[[0,");\r\n            "],[-1,"  "],[-1,"  "],[0,"if (/^data/.test"]],"start1":8731,"start2":8731,"length1":36,"length2":32},{"diffs":[[0,"continue }\r\n"],[-1,"    "],[0,"            "]],"start1":8772,"start2":8772,"length1":28,"length2":24},{"diffs":[[0,"href))\r\n"],[-1,"    "],[0,"        "]],"start1":8843,"start2":8843,"length1":20,"length2":16}]],"length":12600,"saved":false}
{"ts":1355613736352,"patch":[[{"diffs":[[0,"\r\n\r\n        "],[-1,"    "],[0,"var head = d"]],"start1":8860,"start2":8860,"length1":28,"length2":24},{"diffs":[[0,"head\")[0];\r\n"],[-1,"    "],[0,"        var "]],"start1":8909,"start2":8909,"length1":28,"length2":24},{"diffs":[[0,"ink\");\r\n        "],[-1,"    "],[0,"for (var i = 0, "]],"start1":8969,"start2":8969,"length1":36,"length2":32},{"diffs":[[0,"i < il; i++) {\r\n"],[-1,"    "],[0,"            var "]],"start1":9020,"start2":9020,"length1":36,"length2":32},{"diffs":[[0,"            "],[-1,"    "],[0,"if (link.get"]],"start1":9070,"start2":9070,"length1":28,"length2":24},{"diffs":[[0," \"text/css\") {\r\n"],[-1,"    "],[0,"                "]],"start1":9115,"start2":9115,"length1":36,"length2":32},{"diffs":[[0,"                "],[-1,"    "],[0,"inlineStyle.setA"]],"start1":9199,"start2":9199,"length1":36,"length2":32},{"diffs":[[0,"                "],[-1,"   "],[-1," "],[0,"inlineStyle.setA"]],"start1":9262,"start2":9262,"length1":36,"length2":32},{"diffs":[[0,"href\"));\r\n\r\n"],[-1,"    "],[0,"            "]],"start1":9340,"start2":9340,"length1":28,"length2":24},{"diffs":[[0,"                "],[-1,"   "],[-1," "],[0,"inlineStyle.appe"]],"start1":9442,"start2":9442,"length1":36,"length2":32},{"diffs":[[0,"        "],[-1,"    "],[0,"head.rep"]],"start1":9524,"start2":9524,"length1":20,"length2":16},{"diffs":[[0,"            "],[-1,"  "],[-1,"  "],[0,"}\r\n"],[-1,"    "],[0,"        }\r\n\r"]],"start1":9571,"start2":9571,"length1":35,"length2":27},{"diffs":[[0,"   }\r\n\r\n        "],[-1,"  "],[-1,"  "],[0,"return doc;\r\n   "]],"start1":9591,"start2":9591,"length1":36,"length2":32},{"diffs":[[0,"n doc;\r\n    "],[-1,"    },"],[1,"}"],[0,"\r\n\r\n        "]],"start1":9612,"start2":9612,"length1":30,"length2":25}]],"length":12539,"saved":false}
{"ts":1355613771367,"patch":[[{"diffs":[[0,"nent(escape("],[-1,"this."],[1,"_"],[0,"files[href])"]],"start1":8462,"start2":8462,"length1":29,"length2":25},{"diffs":[[0,"(\"src\", "],[-1,"this."],[0,"getDataU"]],"start1":8810,"start2":8810,"length1":21,"length2":16},{"diffs":[[0,"s = "],[-1,"this."],[1,"_"],[0,"files["],[-1,"this."],[0,"reso"]],"start1":9365,"start2":9365,"length1":24,"length2":15},{"diffs":[[0,"   }\r\n\r\n    "],[-1,"   "],[1,"function"],[0," getDataUri:"]],"start1":9603,"start2":9603,"length1":27,"length2":32},{"diffs":[[0,"tDataUri"],[-1,": function "],[0,"(url, hr"]],"start1":9626,"start2":9626,"length1":27,"length2":16},{"diffs":[[0,"ref) {\r\n        "],[-1,"    "],[0,"var dataHref = t"]],"start1":9641,"start2":9641,"length1":36,"length2":32},{"diffs":[[0,"th(url, href);\r\n"],[-1,"    "],[0,"        var medi"]],"start1":9686,"start2":9686,"length1":36,"length2":32},{"diffs":[[0,");\r\n        "],[-1,"   "],[-1," "],[0,"var encodedD"]],"start1":9759,"start2":9759,"length1":28,"length2":24},{"diffs":[[0,"ataHref]);\r\n"],[-1,"    "],[0,"        retu"]],"start1":9808,"start2":9808,"length1":28,"length2":24},{"diffs":[[0,"dData;\r\n    "],[-1,"    },"],[1,"}"],[0,"\r\n\r\n        "]],"start1":9869,"start2":9869,"length1":30,"length2":25}]],"length":12494,"saved":false}
{"ts":1355613780530,"patch":[[{"diffs":[[0,"aHref = "],[-1,"this."],[0,"resolveP"]],"start1":9664,"start2":9664,"length1":21,"length2":16},{"diffs":[[0,"aType = "],[-1,"this."],[0,"findMedi"]],"start1":9713,"start2":9713,"length1":21,"length2":16},{"diffs":[[0," escape("],[-1,"this."],[1,"_"],[0,"files[da"]],"start1":9778,"start2":9778,"length1":21,"length2":17}]],"length":12480,"saved":false}
{"ts":1355613853635,"patch":[[{"diffs":[[0,"\r\n\r\n    "],[-1,"   "],[1,"function"],[0," validat"]],"start1":9868,"start2":9868,"length1":19,"length2":24},{"diffs":[[0,"validate"],[-1,": function "],[0,"() {\r\n  "]],"start1":9885,"start2":9885,"length1":27,"length2":16},{"diffs":[[0,"        "],[-1,"    if (this."],[1,"if (_"],[0,"containe"]],"start1":9899,"start2":9899,"length1":29,"length2":21},{"diffs":[[0,"= undefined) {\r\n"],[-1," "],[0,"               t"]],"start1":9924,"start2":9924,"length1":33,"length2":32},{"diffs":[[0,");\r\n        "],[-1,"    "],[0,"}\r\n\r\n"],[-1,"    "],[0,"        if ("]],"start1":10011,"start2":10011,"length1":37,"length2":29},{"diffs":[[0,"\r\n\r\n        if ("],[-1,"this."],[1,"_"],[0,"mimetype === und"]],"start1":10024,"start2":10024,"length1":37,"length2":33},{"diffs":[[0,"= undefined) {\r\n"],[-1,"    "],[0,"            thro"]],"start1":10052,"start2":10052,"length1":36,"length2":32},{"diffs":[[0,"nd.\");\r\n        "],[-1,"    "],[0,"}\r\n\r\n           "]],"start1":10118,"start2":10118,"length1":36,"length2":32},{"diffs":[[0,"    "],[-1," "],[-1,"   "],[0,"if ("],[-1,"this."],[1,"_"],[0,"mime"]],"start1":10143,"start2":10143,"length1":21,"length2":13},{"diffs":[[0,"ub+zip\") {\r\n"],[-1,"    "],[0,"            "]],"start1":10180,"start2":10180,"length1":28,"length2":24},{"diffs":[[0,"ype \" + "],[-1,"this."],[1,"_"],[0,"mimetype"]],"start1":10236,"start2":10236,"length1":21,"length2":17},{"diffs":[[0,"    "],[-1,"    "],[0,"}\r\n    "],[-1,"  "],[-1,"  },"],[1,"}"],[0,"\r\n\r\n"]],"start1":10261,"start2":10261,"length1":25,"length2":16},{"diffs":[[0,"Is\r\n    "],[-1,"   "],[1,"function"],[0," escapeD"]],"start1":10299,"start2":10299,"length1":19,"length2":24},{"diffs":[[0,"capeData"],[-1,": function "],[0,"(data) {"]],"start1":10318,"start2":10318,"length1":27,"length2":16},{"diffs":[[0,"ta(data) {\r\n"],[-1,"    "],[0,"        retu"]],"start1":10324,"start2":10324,"length1":28,"length2":24},{"diffs":[[0,"    "],[-1," "],[-1,"   },"],[1,"}"],[0,"\r\n\r\n    "],[-1,"   "],[1,"function"],[0," xml"]],"start1":10366,"start2":10366,"length1":25,"length2":25},{"diffs":[[0,"ment"],[-1,": function "],[0,"(xml"]],"start1":10395,"start2":10395,"length1":19,"length2":8},{"diffs":[[0,"ent(xml) {\r\n"],[-1,"    "],[0,"        var "]],"start1":10396,"start2":10396,"length1":28,"length2":24},{"diffs":[[0,"\r\n\r\n        "],[-1,"    "],[0,"if (doc.chil"]],"start1":10475,"start2":10475,"length1":28,"length2":24},{"diffs":[[0,"            "],[-1,"    "],[0,"throw doc.ch"]],"start1":10561,"start2":10561,"length1":28,"length2":24},{"diffs":[[0,"e;\r\n        "],[-1,"  "],[-1,"  "],[0,"}\r\n\r\n"],[-1,"    "],[0,"        retu"]],"start1":10619,"start2":10619,"length1":37,"length2":29},{"diffs":[[0,"n doc;\r\n"],[-1,"    "],[0,"    }\r\n "]],"start1":10649,"start2":10649,"length1":20,"length2":16}]],"length":12375,"saved":false}
{"ts":1355613930385,"patch":[[{"diffs":[[0,"        "],[1,"_"],[0,"compress"]],"start1":2921,"start2":2921,"length1":16,"length2":17},{"diffs":[[0,"dFile = "],[1,"_"],[0,"compress"]],"start1":3207,"start2":3207,"length1":16,"length2":17},{"diffs":[[0,"pe === 3) { "],[-1,"continue"],[1,"\r\n                continue; \r\n           "],[0," }\r\n\r\n      "]],"start1":5153,"start2":5153,"length1":32,"length2":65}]],"length":12410,"saved":false}
{"ts":1355614016523,"patch":[[{"diffs":[[0,"\"href\": "],[-1,"this."],[0,"resolveP"]],"start1":5856,"start2":5856,"length1":21,"length2":16},{"diffs":[[0,"\"), "],[-1,"this."],[1,"_"],[0,"opfP"]],"start1":5899,"start2":5899,"length1":13,"length2":9},{"diffs":[[0,"oin(\"/\");\r\n    }"],[-1,";"],[0,"\r\n\r\n    function"]],"start1":6893,"start2":6893,"length1":33,"length2":32},{"diffs":[[0,"src)) { "],[-1,"continue"],[1,"\r\n                continue;\r\n           "],[0," }\r\n    "]],"start1":8785,"start2":8785,"length1":24,"length2":56}]],"length":12432,"saved":false}
{"ts":1355614121379,"patch":[[{"diffs":[[0,");\r\n    "],[-1,"    },"],[1,"}"],[0,"\r\n\r\n    "]],"start1":4072,"start2":4072,"length1":22,"length2":17}]],"length":12427,"saved":false}
{"ts":1355614199066,"patch":[[{"diffs":[[0,"nit,\r\n        \r\n"],[1,"        unzipper = function(){return _unzipper;}\r\n    var _compressedFiles;\r\n    var _files = {};\r\n    var _opfPath;\r\n    var _container;\r\n    var _mimetype;\r\n    var _opf;\r\n        \r\n"],[0,"        /*Monocl"]],"start1":12178,"start2":12178,"length1":32,"length2":216}]],"length":12611,"saved":false}
{"ts":1355614253030,"patch":[[{"diffs":[[0,"it :"],[1," "],[0," init,\r\n"],[-1,""],[0,"    "]],"start1":12172,"start2":12172,"length1":16,"length2":17},{"diffs":[[0,"unzipper"],[1,":         "],[0," "],[-1,"="],[0," functio"]],"start1":12203,"start2":12203,"length1":18,"length2":27},{"diffs":[[0,"zipper;}"],[1,","],[0,"\r\n    "],[-1,"var"],[1,"    compressedFiles:    function(){return"],[0," _compre"]],"start1":12244,"start2":12244,"length1":25,"length2":64},{"diffs":[[0,"ressedFiles;"],[1,"},"],[0,"\r\n    "],[1," "],[-1,"var"],[1,"   files:              function(){return"],[0," _files = {}"]],"start1":12306,"start2":12306,"length1":33,"length2":73},{"diffs":[[0,"urn _files = {};"],[1,"},"],[0,"\r\n    var _opfPa"]],"start1":12364,"start2":12364,"length1":32,"length2":34}]],"length":12702,"saved":false}
{"ts":1355614288624,"patch":[[{"diffs":[[0,"n _files"],[-1," = {}"],[0,";},\r\n   "]],"start1":12366,"start2":12366,"length1":21,"length2":16},{"diffs":[[0,"les;},\r\n    "],[-1,"var"],[1,"    opfPath:            function(){return"],[0," _opfPath;\r\n"]],"start1":12371,"start2":12371,"length1":27,"length2":65},{"diffs":[[0,"return _opfPath;"],[1,"},"],[0,"\r\n    var _conta"]],"start1":12418,"start2":12418,"length1":32,"length2":34}]],"length":12737,"saved":false}
{"ts":1355614320670,"patch":[[{"diffs":[[0,"ath;},\r\n    "],[-1,"var"],[1,"    container:          function(){return"],[0," _container;"]],"start1":12430,"start2":12430,"length1":27,"length2":65},{"diffs":[[0," _container;"],[1,"},"],[0,"\r\n    "],[1," "],[-1,"var"],[1,"   _mimetype:          function(){return"],[0," _mimetype;\r"]],"start1":12483,"start2":12483,"length1":33,"length2":73},{"diffs":[[0,"eturn _mimetype;"],[1,"}"],[0,"\r\n    var _opf;\r"]],"start1":12539,"start2":12539,"length1":32,"length2":33}]],"length":12816,"saved":false}
{"ts":1355614340522,"patch":[[{"diffs":[[0,"ner;},\r\n        "],[-1,"_"],[0,"mimetype:       "]],"start1":12491,"start2":12491,"length1":33,"length2":32},{"diffs":[[0,"metype;}"],[1,","],[0,"\r\n    "],[-1,"var"],[1,"    opf:               function(){return"],[0," _opf;"],[1,"},"],[0,"\r\n      "]],"start1":12547,"start2":12547,"length1":31,"length2":71}]],"length":12855,"saved":false}
{"ts":1355614345950,"patch":[[{"diffs":[[0,"etype:          "],[1," "],[0,"function(){retur"]],"start1":12510,"start2":12510,"length1":32,"length2":33},{"diffs":[[0,"    opf:"],[1," "],[0,"        "]],"start1":12563,"start2":12563,"length1":16,"length2":17}]],"length":12857,"saved":false}
{"ts":1355614406427,"patch":[[{"diffs":[[0,"inished!';\r\n"],[1,"    MSG.FINISHED_POST_PROCESSING = 'FINISHED_POST_PROCESSING';\r\n"],[0,"    \r\n    MS"]],"start1":569,"start2":569,"length1":24,"length2":88}]],"length":12921,"saved":false}
{"ts":1355614465630,"patch":[[{"diffs":[[0,"  }\r\n        }\r\n"],[1,"        publish(EVENT_LOADING,STATE.OK,MSG.FINISHED_POST_PROCESSING);\r\n"],[0,"    }\r\n    \r\n   "]],"start1":7968,"start2":7968,"length1":32,"length2":103}]],"length":12992,"saved":false}
{"ts":1355614493183,"patch":[[{"diffs":[[0,"_LOADING';\r\n    "],[1,"var EVENT_READY = 'EVENT_BOOKDATA_READY';"],[0,"\r\n    var MSG = "]],"start1":295,"start2":295,"length1":32,"length2":73}]],"length":13033,"saved":false}
{"ts":1355614497883,"patch":[[{"diffs":[[0,"r EVENT_"],[1,"BOOKDATA_"],[0,"READY = "]],"start1":313,"start2":313,"length1":16,"length2":25}]],"length":13042,"saved":false}
{"ts":1355614543541,"patch":[[{"diffs":[[0,"OCESSING);\r\n"],[1,"        publish(EVENT_BOOKDATA_READY, this);\r\n"],[0,"    }\r\n    \r"]],"start1":8093,"start2":8093,"length1":24,"length2":70}]],"length":13088,"saved":false}
{"ts":1355614655804,"patch":[[{"diffs":[[0,"//////////////\r\n"],[1,"    var EVENT ={};\r\n    EVENT.LOADING = 'EVENT_LOADING';\r\n    EVENT.BOOKDATA_READY\r\n    \r\n"],[0,"    var EVENT_LO"]],"start1":249,"start2":249,"length1":32,"length2":122}]],"length":13178,"saved":false}
{"ts":1355614660369,"patch":[[{"diffs":[[0,"TA_READY"],[1," = 'EVENT_BOOKDATA_READY';"],[0,"\r\n    \r\n"]],"start1":339,"start2":339,"length1":16,"length2":42}]],"length":13204,"saved":false}
{"ts":1355614699995,"patch":[[{"diffs":[[0,"   publish(EVENT"],[-1,"_"],[1,"."],[0,"LOADING, STATE.O"]],"start1":2878,"start2":2878,"length1":33,"length2":33},{"diffs":[[0,"   publish(EVENT"],[-1,"_"],[1,"."],[0,"LOADING, STATE.E"]],"start1":3293,"start2":3293,"length1":33,"length2":33},{"diffs":[[0,"   publish(EVENT"],[-1,"_"],[1,"."],[0,"LOADING, STATE.O"]],"start1":3512,"start2":3512,"length1":33,"length2":33},{"diffs":[[0,"   publish(EVENT"],[-1,"_"],[1,"."],[0,"LOADING, STATE.O"]],"start1":4001,"start2":4001,"length1":33,"length2":33},{"diffs":[[0,"   publish(EVENT"],[-1,"_"],[1,"."],[0,"LOADING, STATE.O"]],"start1":4158,"start2":4158,"length1":33,"length2":33},{"diffs":[[0,"   publish(EVENT"],[-1,"_"],[1,"."],[0,"LOADING, STATE.O"]],"start1":4254,"start2":4254,"length1":33,"length2":33}]],"length":13204,"saved":false}
{"ts":1355614712621,"patch":[[{"diffs":[[0,"   publish(EVENT"],[-1,"_"],[1,"."],[0,"LOADING,STATE.OK"]],"start1":8155,"start2":8155,"length1":33,"length2":33},{"diffs":[[0,"ublish(EVENT"],[-1,"_"],[1,"."],[0,"BOOKDATA_REA"]],"start1":8230,"start2":8230,"length1":25,"length2":25}]],"length":13204,"saved":false}
{"ts":1355614722643,"patch":[[{"diffs":[[0,"   publish(EVENT"],[-1,"_"],[1,"."],[0,"LOADING, STATE.O"]],"start1":11335,"start2":11335,"length1":33,"length2":33},{"diffs":[[0,"ublish(EVENT"],[-1,"_"],[1,"."],[0,"LOADING, STA"]],"start1":11486,"start2":11486,"length1":25,"length2":25}]],"length":13204,"saved":false}
{"ts":1355614734060,"patch":[[{"diffs":[[0,"    "],[-1,"var EVENT_LOADING = 'EVENT_LOADING';\r\n    var EVENT_BOOKDATA_READY = 'EVENT_BOOKDATA_READY';"],[0,"\r\n  "]],"start1":381,"start2":381,"length1":100,"length2":8}]],"length":13112,"saved":false}
{"ts":1355614774743,"patch":[[{"diffs":[[0,"t :  init,\r\n"],[1,"        events : function(){return EVENT;}\r\n"],[0,"        \r\n  "]],"start1":12428,"start2":12428,"length1":24,"length2":68}]],"length":13156,"saved":false}
{"ts":1355614785352,"patch":[[{"diffs":[[0," EVENT;}"],[1,","],[0,"\r\n      "]],"start1":12474,"start2":12474,"length1":16,"length2":17}]],"length":13157,"saved":false}
{"ts":1355615032859,"patch":[[{"diffs":[[0,"DY, this);\r\n"],[1,"        console.log(this);\r\n"],[0,"    }\r\n    \r"]],"start1":8163,"start2":8163,"length1":24,"length2":52}]],"length":13185,"saved":false}
{"ts":1355615093986,"patch":[[{"diffs":[[0,"catch(ex){\r\n"],[1,"            console.log(eg);\r\n"],[0,"            "]],"start1":3180,"start2":3180,"length1":24,"length2":54}]],"length":13215,"saved":false}
{"ts":1355615155581,"patch":[[{"diffs":[[0,"le.log(e"],[-1,"g"],[1,"x"],[0,");\r\n    "]],"start1":3209,"start2":3209,"length1":17,"length2":17}]],"length":13215,"saved":false}
{"ts":1355615193540,"patch":[[{"diffs":[[0,"        "],[1,"//"],[0,"try{\r\n  "]],"start1":2763,"start2":2763,"length1":16,"length2":18},{"diffs":[[0,"      \r\n        "],[1,"//"],[0,"}\r\n        catch"]],"start1":3155,"start2":3155,"length1":32,"length2":34},{"diffs":[[0,"        "],[1,"//"],[0,"catch(ex"]],"start1":3176,"start2":3176,"length1":16,"length2":18},{"diffs":[[0,"        "],[1,"//"],[0,"}\r\n\t}\r\n "]],"start1":3292,"start2":3292,"length1":16,"length2":18}]],"length":13223,"saved":false}
{"ts":1355615255296,"patch":[[{"diffs":[[0,"er.files"],[1,", typeof(_unzipper.files)"],[0,");\r\n    "]],"start1":3045,"start2":3045,"length1":16,"length2":41}]],"length":13248,"saved":false}
{"ts":1355615549782,"patch":[[{"diffs":[[0,"r.files));\r\n"],[1,"            \r\n"],[0,"            "]],"start1":3070,"start2":3070,"length1":24,"length2":38},{"diffs":[[0,"les="],[-1," _unzipper.files;"],[1,"[];\r\n            for(var key in _unzipper.files){\r\n                var item = _unzipper.files[key];\r\n                if(item){\r\n                    _compressedFiles.push(item);\r\n                }\r\n            }\r\n            "],[0,"\r\n  "]],"start1":3121,"start2":3121,"length1":25,"length2":232}]],"length":13469,"saved":false}
{"ts":1355615593221,"patch":[[{"diffs":[[0,"){\r\n            "],[1,"//"],[0,"console.log(ex);"]],"start1":3440,"start2":3440,"length1":32,"length2":34}]],"length":13471,"saved":false}
{"ts":1355615620092,"patch":[[{"diffs":[[0,"(event, "],[-1,"["],[0,"state, m"]],"start1":12069,"start2":12069,"length1":17,"length2":16},{"diffs":[[0," message"],[-1,"]"],[0,");\r\n    "]],"start1":12083,"start2":12083,"length1":17,"length2":16}]],"length":13469,"saved":false}
{"ts":1355615631937,"patch":[[{"diffs":[[0,".trigger(event, "],[1,"["],[0,"state, message);"]],"start1":12061,"start2":12061,"length1":32,"length2":33},{"diffs":[[0," message"],[1,"]"],[0,");\r\n    "]],"start1":12084,"start2":12084,"length1":16,"length2":17}]],"length":13471,"saved":false}
{"ts":1355615792502,"patch":[[{"diffs":[[0,"rn _opf;},\r\n"],[1,"        publish:    publish,\r\n"],[0,"        \r\n  "]],"start1":13216,"start2":13216,"length1":24,"length2":54}]],"length":13501,"saved":false}
{"ts":1355617677980,"patch":[[{"diffs":[[0," var _opf;\r\n"],[1,"    var _epubVersion;\r\n"],[0,"    ////////"]],"start1":1037,"start2":1037,"length1":24,"length2":47}]],"length":13524,"saved":false}
{"ts":1355617778225,"patch":[[{"diffs":[[0,"opf = opf;\r\n"],[1,"        \r\n        //Additions Dec 15, 2012\r\n        \r\n        \r\n"],[0,"    }\r\n\r\n   "]],"start1":6762,"start2":6762,"length1":24,"length2":88}]],"length":13588,"saved":false}
{"ts":1355617826460,"patch":[[{"diffs":[[0,", 2012\r\n        "],[1,"// Get the NCX\r\n        var opf_item_tag = 'opf\\\\:item';\r\n        var epub_version_tag = 'opf\\\\:package';\r\n    \r\n        if ($(f).find('opf\\\\:item').length == 0) {\r\n            opf_item_tag = 'item';\r\n            epub_version_tag = 'package';\r\n        }\r\n        \r\n        _epubversion = parseInt($('<div/>').append($(f)).find(epub_version_tag).attr('version'), 10);\r\n\t\r\n        $(f).find(opf_item_tag).each(\r\n\t\t\tfunction() {\r\n\t\t\t\t// Cheat and find the first file ending in NCX\r\n\t\t\t\t// modified to include ePub 3 support\r\n\t\t\t\tif ($(this).attr('href').indexOf('.ncx') != -1\r\n\t\t\t\t\t\t|| $(this).attr('id').toLowerCase() === 'toc') {\r\n\t\t\t\t\tif(oebps_dir){\r\n                        ncx_file = oebps_dir + '/' + $(this).attr('href');\r\n\t\t\t\t\t}\r\n\t\t\t\t\telse{\r\n\t\t\t\t\t\tncx_file =  $(this).attr('href');\r\n\t\t\t\t\t}\r\n\t\t\t\t\t// jQuery.get(ncx_file, {}, toc);\r\n\t\t\t\t\t// console.log(ncx_file);\r\n\t\t\t\t\tgetDataFromEpub(ncx_file, function(response) {\r\n\t\t\t\t\t\ttoc(response);\r\n\t\t\t\t\t});\r\n\t\t\t\t}\r\n\t\t});"],[0,"\r\n        \r\n    "]],"start1":6810,"start2":6810,"length1":32,"length2":997},{"diffs":[[0,"        \r\n    }\r"],[1,"\n    \r"],[0,"\n\r\n    function "]],"start1":7793,"start2":7793,"length1":32,"length2":38}]],"length":14559,"saved":false}
{"ts":1355618121467,"patch":[[{"diffs":[[0,"opf;\r\n        \r\n"],[1,"        \r\n        console.log(xml);\r\n//"],[0,"        //Additi"]],"start1":6768,"start2":6768,"length1":32,"length2":71},{"diffs":[[0,", 2012\r\n"],[1,"//"],[0,"        "]],"start1":6849,"start2":6849,"length1":16,"length2":18},{"diffs":[[0,"he NCX\r\n"],[1,"//"],[0,"        "]],"start1":6875,"start2":6875,"length1":16,"length2":18},{"diffs":[[0," 'opf\\\\:item';\r\n"],[1,"//"],[0,"        var epub"]],"start1":6911,"start2":6911,"length1":32,"length2":34},{"diffs":[[0,":package';\r\n"],[1,"//"],[0,"    \r\n"],[1,"//"],[0,"        if ("]],"start1":6966,"start2":6966,"length1":30,"length2":34},{"diffs":[[0,"th == 0) {\r\n"],[1,"//"],[0,"            "]],"start1":7028,"start2":7028,"length1":24,"length2":26},{"diffs":[[0," = 'item';\r\n"],[1,"//"],[0,"            "]],"start1":7066,"start2":7066,"length1":24,"length2":26},{"diffs":[[0,"'package';\r\n"],[1,"//"],[0,"        }\r\n "]],"start1":7111,"start2":7111,"length1":24,"length2":26},{"diffs":[[0,";\r\n//        }\r\n"],[1,"//"],[0,"        \r\n      "]],"start1":7120,"start2":7120,"length1":32,"length2":34},{"diffs":[[0," }\r\n//        \r\n"],[1,"//"],[0,"        _epubver"]],"start1":7132,"start2":7132,"length1":32,"length2":34},{"diffs":[[0,");\r\n"],[1,"//"],[0,"\t\r\n"],[1,"//"],[0,"    "]],"start1":7249,"start2":7249,"length1":11,"length2":15},{"diffs":[[0,".each(\r\n"],[1,"//"],[0,"\t\t\tfunct"]],"start1":7291,"start2":7291,"length1":16,"length2":18},{"diffs":[[0,"nction() {\r\n"],[1,"//"],[0,"\t\t\t\t// Cheat"]],"start1":7306,"start2":7306,"length1":24,"length2":26},{"diffs":[[0,"in NCX\r\n"],[1,"//"],[0,"\t\t\t\t// m"]],"start1":7364,"start2":7364,"length1":16,"length2":18},{"diffs":[[0,"upport\r\n"],[1,"//"],[0,"\t\t\t\tif ("]],"start1":7409,"start2":7409,"length1":16,"length2":18},{"diffs":[[0," != -1\r\n"],[1,"//"],[0,"\t\t\t\t\t\t||"]],"start1":7463,"start2":7463,"length1":16,"length2":18},{"diffs":[[0,"= 'toc') {\r\n"],[1,"//"],[0,"\t\t\t\t\tif(oebp"]],"start1":7517,"start2":7517,"length1":24,"length2":26},{"diffs":[[0,"ebps_dir){\r\n"],[1,"//"],[0,"            "]],"start1":7540,"start2":7540,"length1":24,"length2":26},{"diffs":[[0,"r('href');\r\n"],[1,"//"],[0,"\t\t\t\t\t}\r\n"],[1,"//"],[0,"\t\t\t\t\telse{\r\n"]],"start1":7618,"start2":7618,"length1":32,"length2":36},{"diffs":[[0,"\telse{\r\n"],[1,"//"],[0,"\t\t\t\t\t\tnc"]],"start1":7646,"start2":7646,"length1":16,"length2":18},{"diffs":[[0,"r('href');\r\n"],[1,"//"],[0,"\t\t\t\t\t}\r\n"],[1,"//"],[0,"\t\t\t\t\t// jQue"]],"start1":7685,"start2":7685,"length1":32,"length2":36},{"diffs":[[0," {}, toc);\r\n"],[1,"//"],[0,"\t\t\t\t\t// cons"]],"start1":7737,"start2":7737,"length1":24,"length2":26},{"diffs":[[0,"ncx_file);\r\n"],[1,"//"],[0,"\t\t\t\t\tgetData"]],"start1":7771,"start2":7771,"length1":24,"length2":26},{"diffs":[[0,"esponse) {\r\n"],[1,"//"],[0,"\t\t\t\t\t\ttoc(re"]],"start1":7826,"start2":7826,"length1":24,"length2":26},{"diffs":[[0,"response);\r\n"],[1,"//"],[0,"\t\t\t\t\t});\r\n\t\t"]],"start1":7850,"start2":7850,"length1":24,"length2":26},{"diffs":[[0,"\t\t\t});\r\n"],[1,"//"],[0,"\t\t\t\t}\r\n"],[1,"//"],[0,"\t\t});\r\n "]],"start1":7866,"start2":7866,"length1":23,"length2":27}]],"length":14658,"saved":false}
{"ts":1355618365892,"patch":[[{"diffs":[[0,"(xml);\r\n"],[-1,"//"],[0,"        "]],"start1":6813,"start2":6813,"length1":18,"length2":16},{"diffs":[[0,", 2012\r\n"],[-1,"//"],[0,"        "]],"start1":6847,"start2":6847,"length1":18,"length2":16},{"diffs":[[0,"he NCX\r\n"],[-1,"//"],[0,"        "]],"start1":6871,"start2":6871,"length1":18,"length2":16},{"diffs":[[0," = '"],[-1,"opf\\\\:"],[0,"item';\r\n"],[-1,"//"],[0,"    "]],"start1":6903,"start2":6903,"length1":24,"length2":16},{"diffs":[[0,"_tag = '"],[-1,"opf\\\\:"],[0,"package'"]],"start1":6939,"start2":6939,"length1":22,"length2":16},{"diffs":[[0,"';\r\n"],[-1,"//"],[0,"    \r\n"],[-1,"//"],[0,"    "]],"start1":6954,"start2":6954,"length1":18,"length2":14},{"diffs":[[0,"= 0) {\r\n"],[-1,"//"],[0,"        "]],"start1":7008,"start2":7008,"length1":18,"length2":16},{"diffs":[[0," = 'item';\r\n"],[-1,"//"],[0,"            "]],"start1":7040,"start2":7040,"length1":26,"length2":24},{"diffs":[[0,"kage';\r\n"],[-1,"//"],[0,"        "]],"start1":7087,"start2":7087,"length1":18,"length2":16},{"diffs":[[0,"     }\r\n"],[-1,"//"],[0,"        "]],"start1":7098,"start2":7098,"length1":18,"length2":16},{"diffs":[[0,"      \r\n"],[-1,"//"],[0,"        "]],"start1":7108,"start2":7108,"length1":18,"length2":16},{"diffs":[[0,");\r\n"],[-1,"//"],[0,"\t\r\n"],[-1,"//"],[0,"    "]],"start1":7215,"start2":7215,"length1":15,"length2":11},{"diffs":[[0,".each(\r\n"],[-1,"//"],[0,"\t\t\tfunct"]],"start1":7253,"start2":7253,"length1":18,"length2":16},{"diffs":[[0,"nction() {\r\n"],[-1,"//"],[0,"\t\t\t\t// Cheat"]],"start1":7266,"start2":7266,"length1":26,"length2":24},{"diffs":[[0,"in NCX\r\n"],[-1,"//"],[0,"\t\t\t\t// m"]],"start1":7322,"start2":7322,"length1":18,"length2":16},{"diffs":[[0,"upport\r\n"],[-1,"//"],[0,"\t\t\t\tif ("]],"start1":7365,"start2":7365,"length1":18,"length2":16},{"diffs":[[0," != -1\r\n"],[-1,"//"],[0,"\t\t\t\t\t\t||"]],"start1":7417,"start2":7417,"length1":18,"length2":16},{"diffs":[[0,"= 'toc') {\r\n"],[-1,"//"],[0,"\t\t\t\t\tif(oebp"]],"start1":7469,"start2":7469,"length1":26,"length2":24},{"diffs":[[0,"_dir){\r\n"],[-1,"//"],[0,"        "]],"start1":7494,"start2":7494,"length1":18,"length2":16},{"diffs":[[0,"r('href');\r\n"],[-1,"//"],[0,"\t\t\t\t\t}\r\n"],[-1,"//"],[0,"\t\t\t\t\telse{\r\n"]],"start1":7566,"start2":7566,"length1":36,"length2":32},{"diffs":[[0,"\telse{\r\n"],[-1,"//"],[0,"\t\t\t\t\t\tnc"]],"start1":7590,"start2":7590,"length1":18,"length2":16},{"diffs":[[0,");\r\n"],[-1,"//"],[0,"\t\t\t\t\t}\r\n"],[-1,"//"],[0,"\t\t\t\t"]],"start1":7635,"start2":7635,"length1":20,"length2":16},{"diffs":[[0," {}, toc);\r\n"],[-1,"//"],[0,"\t\t\t\t\t// cons"]],"start1":7675,"start2":7675,"length1":26,"length2":24},{"diffs":[[0,"ncx_file);\r\n"],[-1,"//"],[0,"\t\t\t\t\tgetData"]],"start1":7707,"start2":7707,"length1":26,"length2":24},{"diffs":[[0,"nse) {\r\n"],[-1,"//"],[0,"\t\t\t\t\t\tto"]],"start1":7764,"start2":7764,"length1":18,"length2":16},{"diffs":[[0,"response);\r\n"],[-1,"//"],[0,"\t\t\t\t\t});\r\n//"]],"start1":7782,"start2":7782,"length1":26,"length2":24},{"diffs":[[0,");\r\n"],[-1,"//"],[0,"\t\t\t\t}\r\n"],[-1,"//"],[0,"\t\t})"]],"start1":7800,"start2":7800,"length1":19,"length2":15}]],"length":14584,"saved":false}
{"contributors":[],"silentsave":false,"ts":1355618552559,"patch":[[{"diffs":[[0,"   _epub"],[-1,"v"],[1,"V"],[0,"ersion ="]],"start1":7121,"start2":7121,"length1":17,"length2":17},{"diffs":[[0,"Int("],[-1,"$('<div/>').append($(f)).find(epub_version_tag).attr('"],[1,"xml.getAttribute(\""],[0,"version"],[-1,"'"],[1,"\""],[0,"), 1"]],"start1":7144,"start2":7144,"length1":70,"length2":34},{"diffs":[[0," 10);\r\n\t"],[-1,"\r\n"],[1,"console.log(_epubVersion);\r\n//"],[0,"        "]],"start1":7176,"start2":7176,"length1":18,"length2":46},{"diffs":[[0,".each(\r\n"],[1,"//"],[0,"\t\t\tfunct"]],"start1":7245,"start2":7245,"length1":16,"length2":18},{"diffs":[[0,"nction() {\r\n"],[1,"//"],[0,"\t\t\t\t// Cheat"]],"start1":7260,"start2":7260,"length1":24,"length2":26},{"diffs":[[0,"in NCX\r\n"],[1,"//"],[0,"\t\t\t\t// m"]],"start1":7318,"start2":7318,"length1":16,"length2":18},{"diffs":[[0,"upport\r\n"],[1,"//"],[0,"\t\t\t\tif ("]],"start1":7363,"start2":7363,"length1":16,"length2":18},{"diffs":[[0," != -1\r\n"],[1,"//"],[0,"\t\t\t\t\t\t||"]],"start1":7417,"start2":7417,"length1":16,"length2":18},{"diffs":[[0,"= 'toc') {\r\n"],[1,"//"],[0,"\t\t\t\t\tif(oebp"]],"start1":7471,"start2":7471,"length1":24,"length2":26},{"diffs":[[0,"ebps_dir){\r\n"],[1,"//"],[0,"            "]],"start1":7494,"start2":7494,"length1":24,"length2":26},{"diffs":[[0,"r('href');\r\n"],[1,"//"],[0,"\t\t\t\t\t}\r\n"],[1,"//"],[0,"\t\t\t\t\telse{\r\n"]],"start1":7572,"start2":7572,"length1":32,"length2":36},{"diffs":[[0,"\telse{\r\n"],[1,"//"],[0,"\t\t\t\t\t\tnc"]],"start1":7600,"start2":7600,"length1":16,"length2":18},{"diffs":[[0,"r('href');\r\n"],[1,"//"],[0,"\t\t\t\t\t}\r\n"],[1,"//"],[0,"\t\t\t\t\t// jQue"]],"start1":7639,"start2":7639,"length1":32,"length2":36},{"diffs":[[0," {}, toc);\r\n"],[1,"//"],[0,"\t\t\t\t\t// cons"]],"start1":7691,"start2":7691,"length1":24,"length2":26},{"diffs":[[0,"ncx_file);\r\n"],[1,"//"],[0,"\t\t\t\t\tgetData"]],"start1":7725,"start2":7725,"length1":24,"length2":26},{"diffs":[[0,"esponse) {\r\n"],[1,"//"],[0,"\t\t\t\t\t\ttoc(re"]],"start1":7780,"start2":7780,"length1":24,"length2":26},{"diffs":[[0,"response);\r\n"],[1,"//"],[0,"\t\t\t\t\t});\r\n\t\t"]],"start1":7804,"start2":7804,"length1":24,"length2":26},{"diffs":[[0,"\t\t\t});\r\n"],[1,"//"],[0,"\t\t\t\t}\r\n"],[1,"//"],[0,"\t\t});\r\n "]],"start1":7820,"start2":7820,"length1":23,"length2":27}]],"length":14612,"saved":false}
{"ts":1355619019132,"patch":[[{"diffs":[[0,"  \r\n"],[-1,"        if ($(f).find('opf\\\\:item').length == 0) {\r\n            opf_item_tag = 'item';\r\n            epub_version_tag = 'package';\r\n        }\r\n"],[0,"    "]],"start1":6960,"start2":6960,"length1":150,"length2":8},{"diffs":[[0,"sion);\r\n"],[-1,"//"],[0,"        "]],"start1":7062,"start2":7062,"length1":18,"length2":16},{"diffs":[[0,".each(\r\n"],[-1,"//"],[0,"\t\t\tfunct"]],"start1":7101,"start2":7101,"length1":18,"length2":16},{"diffs":[[0,"nction() {\r\n"],[-1,"//"],[0,"\t\t\t\t// Cheat"]],"start1":7114,"start2":7114,"length1":26,"length2":24},{"diffs":[[0,"in NCX\r\n"],[-1,"//"],[0,"\t\t\t\t// m"]],"start1":7170,"start2":7170,"length1":18,"length2":16},{"diffs":[[0,"upport\r\n"],[-1,"//"],[0,"\t\t\t\tif ("]],"start1":7213,"start2":7213,"length1":18,"length2":16},{"diffs":[[0," != -1\r\n"],[-1,"//"],[0,"\t\t\t\t\t\t||"]],"start1":7265,"start2":7265,"length1":18,"length2":16},{"diffs":[[0,"= 'toc') {\r\n"],[-1,"//"],[0,"\t\t\t\t\tif(oebp"]],"start1":7317,"start2":7317,"length1":26,"length2":24},{"diffs":[[0,"_dir){\r\n"],[-1,"//"],[0,"        "]],"start1":7342,"start2":7342,"length1":18,"length2":16},{"diffs":[[0,"r('href');\r\n"],[-1,"//"],[0,"\t\t\t\t\t}\r\n"],[-1,"//"],[0,"\t\t\t\t\telse{\r\n"]],"start1":7414,"start2":7414,"length1":36,"length2":32},{"diffs":[[0,"\telse{\r\n"],[-1,"//"],[0,"\t\t\t\t\t\tnc"]],"start1":7438,"start2":7438,"length1":18,"length2":16},{"diffs":[[0,");\r\n"],[-1,"//"],[0,"\t\t\t\t\t}\r\n"],[-1,"//"],[0,"\t\t\t\t"]],"start1":7483,"start2":7483,"length1":20,"length2":16},{"diffs":[[0," {}, toc);\r\n"],[-1,"//"],[0,"\t\t\t\t\t// cons"]],"start1":7523,"start2":7523,"length1":26,"length2":24},{"diffs":[[0,"ncx_file);\r\n"],[-1,"//"],[0,"\t\t\t\t\tgetData"]],"start1":7555,"start2":7555,"length1":26,"length2":24},{"diffs":[[0,"nse) {\r\n"],[-1,"//"],[0,"\t\t\t\t\t\tto"]],"start1":7612,"start2":7612,"length1":18,"length2":16},{"diffs":[[0,"response);\r\n"],[-1,"//"],[0,"\t\t\t\t\t});\r\n//"]],"start1":7630,"start2":7630,"length1":26,"length2":24},{"diffs":[[0,");\r\n"],[-1,"//"],[0,"\t\t\t\t}\r\n"],[-1,"//"],[0,"\t\t})"]],"start1":7648,"start2":7648,"length1":19,"length2":15}]],"length":14432,"saved":false}
{"ts":1355619023224,"patch":[[{"diffs":[[0,", 10);\r\n"],[1,"        \r\n"],[0,"\tconsole"]],"start1":7033,"start2":7033,"length1":16,"length2":26}]],"length":14442,"saved":false}
{"ts":1355619104233,"patch":[[{"diffs":[[0,"';\r\n"],[-1,"        var epub_version_tag = 'package';\r\n"],[0,"    "]],"start1":6911,"start2":6911,"length1":51,"length2":8}]],"length":14399,"saved":false}
{"ts":1355619357965,"patch":[[{"diffs":[[0,"rsion;\r\n"],[1,"    var _ncx;\r\n"],[0,"    ////"]],"start1":1064,"start2":1064,"length1":16,"length2":31}]],"length":14414,"saved":false}
{"ts":1355619378172,"patch":[[{"diffs":[[0,"    "],[-1,"    \r\n\tconsole.log(_epubVersion);\r\n        $(f).find(opf_item_tag).each(\r\n\t\t\tfunction() {\r\n\t\t\t\t// Cheat and find the first file ending in NCX\r\n\t\t\t\t// modified to include ePub 3 support\r\n\t\t\t\tif ($(this).attr('href').indexOf('.ncx') != -1\r\n\t\t\t\t\t\t|| $(this).attr('id').toLowerCase() === 'toc') {\r\n\t\t\t\t\tif(oebps_dir){\r\n                        ncx_file = oebps_dir + '/' + $(this).attr('href');\r\n\t\t\t\t\t}\r\n\t\t\t\t\telse{\r\n\t\t\t\t\t\tncx_file =  $(this).attr('href');\r\n\t\t\t\t\t}\r\n\t\t\t\t\t// jQuery.get(ncx_file, {}, toc);\r\n\t\t\t\t\t// console.log(ncx_file);\r\n\t\t\t\t\tgetDataFromEpub(ncx_file, function(response) {\r\n\t\t\t\t\t\ttoc(response);\r\n\t\t\t\t\t});\r\n\t\t\t\t}\r\n\t\t});"],[0,"\r\n  "]],"start1":7013,"start2":7013,"length1":637,"length2":8}]],"length":13785,"saved":false}
{"ts":1355619396981,"patch":[[{"diffs":[[0,");\r\n"],[-1,"        //Additions Dec 15, 2012\r\n        // Get the NCX\r\n        var opf_item_tag = 'item';\r\n    \r\n        \r\n"],[0,"    "]],"start1":6832,"start2":6832,"length1":118,"length2":8}]],"length":13675,"saved":false}
{"ts":1355619413055,"patch":[[{"diffs":[[0,"];\r\n"],[-1,"\r\n            opf.manifest[node.getAttribute(\"id\")"],[1,"            var id = node.getAttribute(\"id\");\r\n            \r\n            if ($(this).attr('href').indexOf('.ncx') != -1\r\n    \t\t\t\t\t|| $(this).attr('id').toLowerCase() === 'toc') {\r\n\t\t\t\t\tif(oebps_dir){\r\n                        ncx_file = oebps_dir + '/' + $(this).attr('href');\r\n\t\t\t\t\t}\r\n\t\t\t\t\telse{\r\n\t\t\t\t\t\tncx_file =  $(this).attr('href');\r\n\t\t\t\t\t}\r\n\t\t\t\t\t// jQuery.get(ncx_file, {}, toc);\r\n\t\t\t\t\t// console.log(ncx_file);\r\n\t\t\t\t\tgetDataFromEpub(ncx_file, function(response) {\r\n\t\t\t\t\t\ttoc(response);\r\n\t\t\t\t\t});\r\n\t\t\t\t}\r\n            \r\n            opf.manifest[id"],[0,"] = "]],"start1":6236,"start2":6236,"length1":58,"length2":559}]],"length":14176,"saved":false}
{"ts":1355619435378,"patch":[[{"diffs":[[0,");\r\n            "],[1,"var href= node.getAttribute(\"href\");"],[0,"\r\n            if"]],"start1":6283,"start2":6283,"length1":32,"length2":68}]],"length":14212,"saved":false}
{"ts":1355619456680,"patch":[[{"diffs":[[0,"    if ("],[-1,"$(this).attr('"],[0,"href"],[-1,"')"],[0,".indexOf"]],"start1":6345,"start2":6345,"length1":36,"length2":20},{"diffs":[[0,"\t|| "],[-1,"$(this).attr('id')"],[1,"id"],[0,".toL"]],"start1":6389,"start2":6389,"length1":26,"length2":10}]],"length":14180,"saved":false}
{"ts":1355619569525,"patch":[[{"diffs":[[0,"e(\"item\");\r\n"],[1,"        \r\n        var ncxFile = '';"],[0,"\r\n        fo"]],"start1":6113,"start2":6113,"length1":24,"length2":59},{"diffs":[[0,"e(\"href\");\r\n"],[1,"            \r\n"],[0,"            "]],"start1":6360,"start2":6360,"length1":24,"length2":38},{"diffs":[[0,"     ncx"],[-1,"_"],[0,"file = o"]],"start1":6513,"start2":6513,"length1":17,"length2":16}]],"length":14228,"saved":false}
{"ts":1355619590720,"patch":[[{"diffs":[[0,"e = "],[-1,"oebps_dir + '/' + $(this).attr('href')"],[1,"h"],[0,";\r\n\t"]],"start1":6524,"start2":6524,"length1":46,"length2":9}]],"length":14191,"saved":false}
{"ts":1355619613467,"patch":[[{"diffs":[[0,"\t\t\t\t"],[-1,"\tif(oebps_dir){\r\n                        ncxfile = h;\r\n\t\t\t\t\t}\r\n\t\t\t\t\telse{\r\n\t\t\t\t\t\tncx_file =  $(this).attr('"],[1,"ncxfile = "],[0,"href"],[-1,"')"],[0,";\r\n"],[-1,"\t\t\t\t\t}\r\n\t\t\t\t\t// jQuery.get(ncx_file, {}, toc);\r\n\t\t\t\t\t// console.log(ncx_file);\r\n\t\t\t\t\tgetDataFromEpub(ncx_file, function(response) {\r\n\t\t\t\t\t\ttoc(response);\r\n\t\t\t\t\t});"],[0,"\r\n\t\t"]],"start1":6473,"start2":6473,"length1":287,"length2":25}]],"length":13929,"saved":false}
{"ts":1355619629221,"patch":[[{"diffs":[[0,"\n\t\t\t\tncx"],[-1,"f"],[1,"F"],[0,"ile = hr"]],"start1":6472,"start2":6472,"length1":17,"length2":17},{"diffs":[[0," href;\r\n"],[-1,"\r\n\t"],[0,"\t\t\t}\r\n  "]],"start1":6486,"start2":6486,"length1":19,"length2":16},{"diffs":[[0,"}\r\n    \r"],[1,"\n    function re\r"],[0,"\n\r\n    f"]],"start1":7174,"start2":7174,"length1":16,"length2":33}]],"length":13943,"saved":false}
{"ts":1355619722505,"patch":[[{"diffs":[[0,", 10);\r\n    "],[1,"    if(ncxFile){\r\n            _ncx = readNcx(_files[ncxFile]);\r\n        }"],[0,"\r\n        \r\n"]],"start1":7146,"start2":7146,"length1":24,"length2":97},{"diffs":[[0,"ction re"],[1,"adNcx(xml){\r\n        \r\n    }"],[0,"\r\n\r\n    "]],"start1":7263,"start2":7263,"length1":16,"length2":44}]],"length":14044,"saved":false}
{"ts":1355619748521,"patch":[[{"diffs":[[0,"rn _opf;},\r\n"],[1,"        ncx:                function(){return _ncx;},\r\n"],[0,"        publ"]],"start1":13759,"start2":13759,"length1":24,"length2":79}]],"length":14099,"saved":false}
{"ts":1355619766439,"patch":[[{"diffs":[[0,"(xml){\r\n        "],[1,"var doc = xmlDocument(xml);"],[0,"\r\n    }\r\n\r\n    f"]],"start1":7276,"start2":7276,"length1":32,"length2":59}]],"length":14126,"saved":false}
{"ts":1355619924442,"patch":[[{"diffs":[[0,"ment(xml);\r\n"],[1,"        \r\n        // ePub 2 compatibility to parse toc.ncx file\r\n        if (epub_version === 2) {\r\n    \t\r\n            // Some ebooks use navPoint while others use ns:navPoint tags\r\n            var nav_tag = 'ns\\\\:navPoint';\r\n            var content_tag = 'ns\\\\:content';\r\n            var text_tag = 'ns\\\\:text';\r\n\t\t\r\n            if ($(f).find('ns\\\\:navPoint').length == 0) {\r\n                nav_tag = 'navPoint';\r\n                content_tag = 'content';\r\n                text_tag = 'text';\r\n            }\r\n\t\t\r\n            $(f).find(nav_tag).each(\r\n                function() {\r\n                    \r\n                    var link;\r\n                    \r\n                    if(oebps_dir){\r\n                        link = oebps_dir + '/' + $(this).find(content_tag).attr('src');\r\n    \t\t\t\t}\r\n\t\t\t\t\telse{\r\n\t\t\t\t\t\tlink = $(this).find(content_tag).attr('src');\r\n\t\t\t\t\t}\r\n                    \r\n                    var title = $(this).find(text_tag+':first').text()\r\n                    var s = $('<span/>').text(title);\r\n\t\t\t\t\tvar a = $('<a/>').attr(\r\n\t\t\t\t\t\t\t'href',\r\n\t\t\t\t\t\t\tlink);\r\n\t\t\t\t\t// If 's' has a parent navPoint, indent it\r\n\t\t\t\t\tif ($(this).parent()[0].tagName.toLowerCase() == nav_tag ) {\r\n\t\t\t\t\t\ts.addClass('indent');\r\n\t\t\t\t\t}\r\n\t\t\t\t\ts.appendTo(a);\r\n\t\t\t\t\ta.appendTo($('<li/>').appendTo('#toc'));\r\n                    \r\n                    toc_arr[toc_arr.length()] = new TOCItem(title,link);\r\n            }); \r\n        }\r\n\r\n        // ePub 3 compatibility to parse toc.xhtml file\r\n        if (epub_version === 3) {\r\n            $(f).filter('nav[epub:type=\"toc\"]').find('li').each(\r\n                function() {\r\n                    var link;\r\n                    \r\n                    if(oebps_dir){\r\n                        link = oebps_dir + '/' + $(this).find('a:first').attr('href');\r\n                    }\r\n\t\t\t\t\telse{\r\n\t\t\t\t\t\tlink =  $(this).find('a:first').attr('href');\r\n\t\t\t\t\t}\r\n                    var title = $(this).find('a:first').text();\r\n\t\t\t\t\tvar s = $('<span/>').text(title);\r\n\t\t\t\t\tvar a = $('<a/>').attr('href', link);\r\n\t\t\t\t\t\r\n\t\t\t\t\t// If 's' has a parent navPoint, indent it\r\n\t\t\t\t\tif ($(this).parent().parent()[0].tagName.toLowerCase() === 'li') {\r\n\t\t\t\t\t\ts.addClass('indent');\r\n\t\t\t\t\t}\r\n\t\t\t\t\ts.appendTo(a);\r\n\t\t\t\t\ta.appendTo($('<li/>').appendTo('#toc'));\r\n                    \r\n                    toc_arr[toc_arr.length()] = new TOCItem(title,link);\r\n\t\t\t\t});\r\n        }\r\n"],[0,"    }\r\n\r\n   "]],"start1":7309,"start2":7309,"length1":24,"length2":2407}]],"length":16509,"saved":false}
{"ts":1355619955875,"patch":[[{"diffs":[[0,"le\r\n        if ("],[1,"_"],[0,"epub"],[-1,"_v"],[1,"V"],[0,"ersion === 2) {\r"]],"start1":7382,"start2":7382,"length1":38,"length2":38}]],"length":16509,"saved":false}
